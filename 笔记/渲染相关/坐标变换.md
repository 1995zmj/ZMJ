# 坐标变换

## 二维

### Scale

$$S_{(s_x,s_y)} = \begin{bmatrix} s_x&0&0\\\ 0&s_y&0\\\ 0&0&1 \end{bmatrix}$$

### Rotation

$$R_{(\alpha)} = \begin{bmatrix} \cos\alpha&-\sin\alpha&0\\\ \sin\alpha&\cos\alpha&0\\\ 0&0&1 \end{bmatrix}$$

### Translation

$$T_{(t_x,t_y)} = \begin{bmatrix} 1&0&t_x\\\ 0&1&t_y\\\ 0&0&1 \end{bmatrix}$$

## 三维

### Rotation

$$R_{x(\alpha)} = \begin{bmatrix} 1&0&0&0\\\ 0&\cos\alpha&-\sin\alpha&0\\\ 0&\sin\alpha&\cos\alpha&0\\\ 0&0&0&1 \end{bmatrix}$$

$$R_{y(\alpha)} = \begin{bmatrix} \cos\alpha&0&\sin\alpha&0\\\ 0&1&0&0\\\ -\sin\alpha&0&\cos\alpha&0\\\ 0&0&0&1 \end{bmatrix}$$

$$R_{z(\alpha)} = \begin{bmatrix} \cos\alpha&-\sin\alpha&0&0\\\ \sin\alpha&\cos\alpha&0&0\\\ 0&0&1&0\\\ 0&0&0&1 \end{bmatrix}$$

## 投影变换

### 正交投影

![avatar](../ImageToMarkdown/QQ20201230191715.png)

$$M_{persp->ortho}^{(4 \times 4)} = \begin{bmatrix} \frac{2}{r - l}&0&0&0\\\ 0&\frac{2}{t - b}&0&0\\\ 0&0&\frac{2}{n - f}&0\\\ 0&0&1&0 \end{bmatrix}\begin{bmatrix} 1&0&0&-\frac{r + l}{2}\\\ 0&1&0&-\frac{t + b}{2}\\\ 0&0&1&-\frac{n + f}{2}\\\ 0&0&0&1 \end{bmatrix}$$

### 透视投影

![avatar](../ImageToMarkdown/QQ20201230174344.png)

变量都带有正负号

远平面变化

$$ \begin{bmatrix} x\\\ y\\\ z\\\ 1 \end{bmatrix}=>\begin{bmatrix} \frac{n}{z}x\\\ \frac{n}{z}y\\\ unknown\\\ 1 \end{bmatrix} == \begin{bmatrix} nx\\\ ny\\\ unknown\\\ z \end{bmatrix}$$

$$M_{persp->ortho}^{(4 \times 4)} \begin{bmatrix} x\\\ y\\\ z\\\ 1 \end{bmatrix}= \begin{bmatrix} nx\\\ ny\\\ unknown\\\ z \end{bmatrix}$$

$$M_{persp->ortho}^{(4 \times 4)} = \begin{bmatrix} n&0&0&0\\\ 0&n&0&0\\\ ?&?&?&?\\\ 0&0&1&0 \end{bmatrix}$$

近平面

$$ \begin{bmatrix} x\\\ y\\\ n\\\ 1 \end{bmatrix}=>\begin{bmatrix} x\\\ y\\\ n\\\ 1 \end{bmatrix} == \begin{bmatrix} nx\\\ ny\\\ n^2\\\ n \end{bmatrix}$$

$$ \begin{bmatrix} 0&0&A&B \end{bmatrix} \begin{bmatrix} x\\\ y\\\ n\\\ 1 \end{bmatrix} = n^2 $$

$$ => An + B = n^2 $$

远平面中心点不变

$$ \begin{bmatrix} 0\\\ 0\\\ f\\\ 1 \end{bmatrix}=>\begin{bmatrix} 0\\\ 0\\\ f\\\ 1 \end{bmatrix} == \begin{bmatrix} 0\\\ 0\\\ f^2\\\ f \end{bmatrix}$$

$$ => Af + B = f^2 $$

解得

$$  A = n + f $$

$$  B = -nf $$

$$M_{persp->ortho} = \begin{bmatrix} n&0&0&0\\\ 0&n&0&0\\\ 0&0&n+f&-nf\\\ 0&0&1&0 \end{bmatrix}$$

$$M_{persp} = M_{ortho}M_{persp->ortho}$$

## 视口变换

转化到屏幕坐标

$$M_{viewport} = \begin{bmatrix} \frac{width}{2}&0&0&\frac{width}{2}\\\ 0&\frac{height}{2}&0&\frac{height}{2}\\\ 0&0&1&0\\\ 0&0&0&1 \end{bmatrix}$$





