# 第6章

#### 光源

在光学里，使用辐照度`irradiance`量化光。 对于平行光来说它的辐照度可通过计算在垂直于`l`的单位面积上单位时间内穿过的能拯来得到 我们可以使用光源方向`l`和表面法线`n`之间的夹角的余弦值来得到。 因为辐照度是和照射到物体表面时光线之间的距离$$d/\cos\theta$$成反比的，因此辐照度就和$$\cos\theta$$成正。$$\cos\theta$$可以使用光源方向`l`和表面法线`n`点积来得到。这就是使用点积来计算辐照度的由来。

#### 吸收和散射

散射只改变光线的方向（包括折射，投射，反射）

吸收只改变光线的密度和颜色

为了区分这两种不同的散射方向，我们在光照模型中使用了不同的部分来计算它们：

* 高光反射`specular`：表示物体表面是如何反射光线的
* 漫反射`diffuse`：表示有多少光线会被折射、吸收和散射出表面。

根据入射光线的数两和方向，我们可以计算出射光线的数量和方 向，我们通常使用出射度`exitaoce`来描述它。辐照度和出射度之间是满足线性关系的，而它们之间的比值就是材质的漫反射和高光反射属性。

#### 着色

着色是根据材质属性（高光反射属性，漫反射属性等）、光源信息（如光源方向、辐照度等），使用等式去计算沿某个观察方向的出射度的过程。该等式即 光照模型（Lighting Model） 。

### 标准光照模型

#### 1. 自发光`emissive`

光线也可以直接由光源发射进入摄像机，而不需要经过任何物体的反射。标准光照模型使用自发光来计算这个部分的贡献度。通常在实时渲染中，自发光的表面往往并不会照亮周围的表面 也就是说 这个物体并不会被当成一个光源。它的计算也很简单，就是直接使用了该材质的自发光颜色：

$$
c_{emissive}=m_{emissive}
$$

#### 2. 环境光 `ambient`

在标准光照模型中，我们使用了一种被称为环境光的部分来近似模拟间接光照。环境光的计算非常简单，它通常是一个全局变量，即场景中的所有物体都使用这个环境光。下面的等式给出了计算环境光的部分

$$
c_{ambient}=g_{ambient}
$$

#### 3. 漫反射`diffuse`

漫反射光照符合`兰伯特定律` 反射光线的强度与表面法线和光源方向之间夹角的余弦值成正比。公式如下：

$$
c_{diffuse}=(c_{light} \cdot m_{diffuse}) max(0, n \cdot I)
$$

> n 表示法线 l 指向光源的单位矢量

`半兰伯特光照模型`

$$
c_{diffuse} = (c_{light} \cdot m_diffuse)(\alpha(\hat{n}\cdot I) + \beta)
$$

#### 4. 高光反射`specular`

`Phong`模型

$$
r = 2(\hat{n} \cdot I )\hat{n} - I
$$

$$
c_{spscular} = (c_{light} \cdot m_{specular})max(0,\hat{v}\cdot r)^{m_{gloss}}
$$

> 其中$$r$$是反射方向，$$mgloss$$是材质的光泽度，也被称为反光度`shininess` 控制高光区域“亮点”有多宽 其中$$m_{specular}$$是光源的颜色和强度

`Blinn`模型

$$
\hat{h} 
= 
\frac 
{\hat{v} + I}
{
  \begin{vmatrix}
    \hat{v} + I
  \end{vmatrix}
}
$$

$$
c_{specular} = (c_{light} \cdot m_{specualr})\max(0,\hat{n}\cdot \hat{h})^{m_{gloss}}
$$

> 其中$$\hat{h}$$是对$$\hat{v}$$和$$\hat{I}$$的去平均后再归一化得到的

#### 逐像素还是逐顶点

给出了基本光照模型使用的数学公式，在哪里计算这些光照模型？ 1. 逐像素光照 2. 逐顶点光照

{% page-ref page="man-fan-she-dai-ma.md" %}

{% page-ref page="gao-guang-fan-she-dai-ma.md" %}
